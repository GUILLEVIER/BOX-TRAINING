<div class="edit-schedule-dialog">
  <h2 mat-dialog-title>
    <mat-icon>edit</mat-icon>
    Editar Clase
  </h2>

  <mat-dialog-content>
    <mat-tab-group animationDuration="300ms">
      <!-- Tab de edición -->
      <mat-tab label="Editar Clase">
        <div class="tab-content">
          <!-- Información del horario -->
          <div class="schedule-info">
            <h3>Información del Horario</h3>
            <div class="time-info">
              <div class="info-item">
                <mat-icon>calendar_today</mat-icon>
                <span><strong>Día:</strong> {{ getDayName() }}</span>
              </div>
              <div class="info-item">
                <mat-icon>access_time</mat-icon>
                <span><strong>Horario:</strong> {{ data.schedule.startTime }} - {{ data.schedule.endTime }}</span>
              </div>
              <div class="info-item">
                <mat-icon>group</mat-icon>
                <span><strong>Reservas Actuales:</strong> {{ data.schedule.currentReservations || 0 }}</span>
              </div>
            </div>
          </div>

          <mat-divider></mat-divider>

          <!-- Formulario de edición -->
          <form [formGroup]="editForm" class="edit-form">
            <h3>Datos de la Clase</h3>

            <!-- Tipo de plan -->
            <mat-form-field appearance="outline">
              <mat-label>Tipo de Clase</mat-label>
              <mat-select formControlName="classType" required>
                <mat-option *ngFor="let planType of data.planTypes" [value]="planType">
                  {{ planType.name }}
                  <span class="plan-format">({{ planType.format }})</span>
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>fitness_center</mat-icon>
              <mat-hint>Selecciona el tipo de entrenamiento</mat-hint>
              <mat-error *ngIf="editForm.get('classType')?.hasError('required')">
                El tipo de clase es requerido
              </mat-error>
            </mat-form-field>

            <!-- Capacidad máxima -->
            <mat-form-field appearance="outline">
              <mat-label>Capacidad Máxima</mat-label>
              <input 
                matInput 
                type="number" 
                formControlName="maxCapacity" 
                min="1" 
                max="50"
                required
              >
              <mat-icon matSuffix>group</mat-icon>
              <mat-hint>Número máximo de estudiantes (1-50)</mat-hint>
              <mat-error *ngIf="editForm.get('maxCapacity')?.hasError('required')">
                La capacidad es requerida
              </mat-error>
              <mat-error *ngIf="editForm.get('maxCapacity')?.hasError('min')">
                La capacidad mínima es 1
              </mat-error>
              <mat-error *ngIf="editForm.get('maxCapacity')?.hasError('max')">
                La capacidad máxima es 50
              </mat-error>
            </mat-form-field>

            <!-- Instructor -->
            <mat-form-field appearance="outline">
              <mat-label>Instructor</mat-label>
              <mat-select formControlName="instructorId" required>
                <mat-option *ngFor="let instructor of data.instructors" [value]="instructor.id">
                  <div class="instructor-option">
                    <div class="instructor-name">{{ getInstructorName(instructor) }}</div>
                    <div class="instructor-specialties">{{ getInstructorSpecialties(instructor) }}</div>
                  </div>
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>person</mat-icon>
              <mat-hint>Selecciona el instructor que dirigirá la clase</mat-hint>
              <mat-error *ngIf="editForm.get('instructorId')?.hasError('required')">
                El instructor es requerido
              </mat-error>
            </mat-form-field>

            <!-- Sala/Lugar -->
            <mat-form-field appearance="outline">
              <mat-label>Sala o Lugar</mat-label>
              <mat-select formControlName="room" required>
                <mat-option *ngFor="let room of rooms" [value]="room">
                  {{ room }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>room</mat-icon>
              <mat-hint>Lugar donde se realizará la clase</mat-hint>
              <mat-error *ngIf="editForm.get('room')?.hasError('required')">
                La sala es requerida
              </mat-error>
            </mat-form-field>

            <!-- Descripción (opcional) -->
            <mat-form-field appearance="outline">
              <mat-label>Descripción (Opcional)</mat-label>
              <textarea 
                matInput 
                formControlName="description" 
                rows="3"
                maxlength="500"
                placeholder="Describe la clase, nivel requerido, equipamiento especial, etc."
              ></textarea>
              <mat-icon matSuffix>description</mat-icon>
              <mat-hint align="end">
                {{ editForm.get('description')?.value?.length || 0 }}/500
              </mat-hint>
              <mat-error *ngIf="editForm.get('description')?.hasError('maxlength')">
                La descripción no puede exceder 500 caracteres
              </mat-error>
            </mat-form-field>
          </form>
        </div>
      </mat-tab>

      <!-- Tab de estudiantes reservados -->
      <mat-tab label="Estudiantes Reservados">
        <div class="tab-content">
          <div class="students-info">
            <h3>
              <mat-icon>group</mat-icon>
              Estudiantes Reservados ({{ reservedStudents().length }})
            </h3>
            
            @if (reservedStudents().length > 0) {
              <mat-list>
                @for (student of reservedStudents(); track student.id) {
                  <mat-list-item>
                    <mat-icon matListItemIcon>person</mat-icon>
                    <div matListItemTitle>{{ student.firstName }} {{ student.lastName }}</div>
                    <div matListItemLine>Reservado</div>
                  </mat-list-item>
                  <mat-divider></mat-divider>
                }
              </mat-list>
            } @else {
              <div class="no-students">
                <mat-icon>info</mat-icon>
                <p>No hay estudiantes reservados para esta clase.</p>
              </div>
            }
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button 
      mat-button 
      (click)="onCancel()"
      [disabled]="loading()"
    >
      Cancelar
    </button>
    
    <button 
      mat-button 
      color="warn"
      (click)="onDelete()"
      [disabled]="loading()"
    >
      <mat-icon>delete</mat-icon>
      Eliminar
    </button>
    
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSave()"
      [disabled]="!editForm.valid || !hasChanges() || loading()"
    >
      @if (loading()) {
        <mat-icon>hourglass_empty</mat-icon>
        Guardando...
      } @else {
        <mat-icon>save</mat-icon>
        Guardar Cambios
      }
    </button>
  </mat-dialog-actions>
</div>
